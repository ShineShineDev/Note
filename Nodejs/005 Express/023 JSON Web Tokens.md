##                                                                JSON Web Tokens



> **`JSON Web Tokens (JWT)`** ` have been introduced as a safe way to represent a set of information between two parties.It was introduced with the` [RFC 7519](https://tools.ietf.org/html/rfc7519) `specification by the Internet Engineering Task Force(IETF).`
>
> `Even though we can use JWT with any type of communication method, today JWT is very popular for handling authentication and authorization via HTTP.`
>
> `The token is composed of a header, a payload, and a signature.`







### Structure of a JWT

- `There are three sections of this JWT, each separated with a dot.`

- `You can also visit` [jwt.io](https://jwt.io/) `and play around with their debugger`

  ```text
  `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.XbPfbIHMI6arZ3Y922BhjWgQzWXcXNrz0ogtVhfEd2o`
  ```

  ⚠️` Most systems can understand JWT`







### Head

- `The first section of the JWT is` **`the header`**, `which is a` **`Base64-encoded string`**. 

- `The header section contains the`**`hashing algorithm`**, `which was used to generate the sign and the` **`type of the token.`**

  ```js
  {
    "alg": "HS256",
    "typ": "JWT"
  }
  ```

  





### Payload ( body )

- `The `**`second`** `section is the` **`payload`** `that` **`contains the JSON object`**`that was sent back to the user. Since this is only Base64-encoded, it` **`can easily be decoded by anyone.`**

  ```js
  {
    "sub": "1234567890",
    "name": "John Doe",
    "iat": 1516239022
  }
  
  // sub : the ID of the user,
  // iat : time when the token was created.
  // sometime you may also see some common properties such as 'eat or exp', which is the expiration time of the token.
  ```

  ⚠️ `It is recommended not to include` **`any sensitive data`** `in JWTs, such as passwords or personally identifiable information.`







### Signature of the token

- `The final section is the signature of the token. This is generated by hashing the string`**`base64UrlEncode(header) + "." + base64UrlEncode(payload) + secret`** `using the algorithm that is mentioned in the header section.`
- ⚠️ **`secret` ** `is a` **`random string`**` which only the server should know. No hash can be converted back to the original text and even a small change of the original string will result in a different hash. So the` **`secret cannot be reverse-engineered.`**







### HTTP Authorization Header 

- `According to the standards, the client should` **`send this token`** `to the server` **`via the HTTP request`** `in a header called `**`Authorization with the form Bearer [JWT_TOKEN]`**. `So the value of the `**`Authorization header `**

```plaintext
Authorization : Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.XbPfbIHMI6arZ3Y922BhjWgQzWXcXNrz0ogtVhfEd2o
```







### Traditional Authentication 

> `Traditional authentication strategy makes use of sessions and cookies, but scaling these solutions is very difficult — as some kind of state is maintained by the server. `

- `HTTP is a stateless protocol, which means that an HTTP request does not maintain state. The server does not know about any previous requests that were sent by the same client.`

- `HTTP requests should be self-contained. They should include the information about previous requests that the user made in the request itself.`

- `There are a few ways of doing this, however, the most popular way is to set a` **`session ID`**,` which is a reference to the user information`

- `The server will store this` **`session ID in memory or in a database`**. `The client will send each request with this `**`sessions ID`**.` The server can then fetch information about the client using this reference`

- ` This session ID is` **`sent to the user as a cookie. `**

  
  
  <img src="../assets/img/http.png"/>





### JWT Authentication 

- `When the client` **`sends an authentication request`** `to the server, server will send a` **`signed JSON token`** `back to the client,instead of just sending back a plain JSON token`

- **`signed JSON token`**`includes` **`all the information about the user`** `with the response.`

- `The server sent a signed token, which can verify that the information is unchanged.`

- `The client will send this` **`token along with all the requests`** `following that. So the server won't have to ` **`store any information`** `about the session.`

- `Structure of a JWT :`

  - `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.XbPfbIHMI6arZ3Y922BhjWgQzWXcXNrz0ogtVhfEd2o`

    

  <img src="../assets/img/jwt.png" />







### Advantages of JWT

- `Provides a stateless authentication solution`
- `Very popular and used by many OAuth service providers, like Google and Facebook`
- `It’s very easy to verify a JWT token`
- `More trustworthy than cookies and sessions`
- `Authentication can be outsourced, or an authentication service can be used`

  







##                                                 Using jsonwebtoken





### Install 

- `Install jwtwebtoken with npm`

  ```js
  npm install jsonwebtoken
  ```

  



### Import 

- `import module to your app`

  ```js
  const jwt = require('jsonwebtoken');
  ```

  



###  Token

- `A token include 3 pieces of information:`

  - `The token secret`

  - `The piece of data to hash in the token`

  - `The token expire time`
  
- **`token secret`** `is a long random string used to encrypt and decrypt the data.`

- `To generate this secret, one option is to use Node.js’s built-in `**`crypto`**` library, like so:`

  ```js
  require('crypto').randomBytes(64).toString("hex");
  '0a8e7ce32df3899a09aac7fe03b5728454c162eda14f1082fc5e7fa092f72ee0b2ff19ace5b73c7d2af672c2449f3db2d0cfd6f380ec397e28bcc5d9b12e7b9e'
  ```

  ⚠️` Be careful!` **`If your secret is simple,`** `the token verification process will be much` **`easier to break by an unauthorized intruder.`**

  ⚠️` Token secret should be store in ` **`.env`** `file`, `to manage Environment variables use `**`dotenv modules`**

  ```js
  // .env 
  TOKEN_SECRET=09f26e402586e2faa8da4c98a35f1b20d6b033c60...
  ```
  





### Generate Access Token

- `To enerate access token you can use sign function`

  ```js
  jwt.sign(userInfo,TOKEN_SECRET, { expiresIn: '1800s' });
  // 1800 seconds = 30 minutes,
  ```

  



### Verify Token

- **`jwt.verify`** `function can verify sent token `

  ```js
  const authHeader = req.headers['authorization']
  const token = authHeader.split(' ')[1] 
  
  jwt.verify(token,TOKEN_SECRET, (err, user) => {
      if (err) return res.sendStatus(403)
      res.send(user);
    })
  
  // user example request
  GET https://example.com:4000/verifyToken
  Authorization: Bearer JWT_ACCESS_TOKEN
  ```

  



### Token Refresh

- 





## Simple Example

```js
const express = require("express");
const jwt = require('jsonwebtoken');

const app = express();

app.get('/getToken',(req,res)=>{
    const user = { 
        username: 'programer',
     };
    const token = jwt.sign(user,'0a8e7ce32df3899a09aac7fe03b5728454c162eda14f1082fc5e7fa092f72ee0b2ff19ace5b73c7d2af672c2449f3db2d0cfd6f380ec397e28bcc5d9b12e7b9e',
    { expiresIn: '1800s' }
    )
    res.send(token);
});

app.get('/verifyToken',(req,res)=>{
    const usertoke = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InByb2dyYW1lciIsImlkIjoiYW9zZGZua2FzZjAyMjAzOW14IiwiaWF0IjoxNjE4NzUzNzMxLCJleHAiOjE2MTg3NTU1MzF9.F8IN7INWqQhP8ArGKNSEzodRikYzRLNQ8Lg0i6gCPcQ';
    
    jwt.verify(usertoke,
  '0a8e7ce32df3899a09aac7fe03b5728454c162eda14f1082fc5e7fa092f72ee0b2ff19ace5b73c7d2af672c2449f3db2d0cfd6f380ec397e28bcc5d9b12e7b9e',
     (err,user) => {
        console.log(err)
        if (err) return res.sendStatus(403)
        res.send(user)
      })
});

app.listen(8000,(err)=>{
    if(err) throw new Error("Server not started !");
    console.log('Server  started ! @8000');
    //debugger.info('Server started ! @8000');
})
```









Crd : [ Janith Kasun ](https://twitter.com/JanithKasun) : https://stackabuse.com/authentication-and-authorization-with-jwts-in-express-js/#disqus_thread)